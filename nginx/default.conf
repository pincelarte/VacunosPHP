# /VacunosPHP/nginx/default.conf

server {
    # Nginx escucha en el puerto 80 dentro del contenedor
    listen 80;
    
    # Define los archivos de índice
    index index.php index.html;
    
    # Define la raíz del documento. ¡IMPORTANTE! Laravel usa la carpeta 'public'.
    root /var/www/html/public;

    # Bloque principal para manejo de URL.
    # Esto es crucial para Laravel (Front Controller Pattern).
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Bloque para procesar archivos PHP
    location ~ \.php$ {
        # Esto es CLAVE: 'fastcgi_pass app:9000' dirige la petición
        # al contenedor 'app' (definido en docker-compose.yml) en su puerto 9000 (PHP-FPM).
        fastcgi_pass app:9000;
        
        fastcgi_index index.php;
        include fastcgi_params;
        
        # Le dice a FPM qué archivo debe ejecutar
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
}
